<!DOCTYPE html>
<html>

<head>
    <title>CampusGo Live Map</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

    <style>
        body {
            margin: 0;
        }
        
        #map {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <script>
        const socket = io("http://127.0.0.1:5000");

        // Initialize map
        var map = L.map('map').setView([12.9716, 77.5946], 14);

        // Add OpenStreetMap tiles
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19
        }).addTo(map);

        let busMarkers = {}; // store marker for each bus

        // When backend sends GPS data:
        socket.on("bus_location", function(data) {
            let busId = data.bus_id;
            let lat = data.latitude;
            let lng = data.longitude;

            // If marker does NOT exist → create new one
            if (!busMarkers[busId]) {
                busMarkers[busId] = L.marker([lat, lng]).addTo(map)
                    .bindPopup("Bus ID: " + busId);
            }
            // If exists → update marker position
            else {
                busMarkers[busId].setLatLng([lat, lng]);
            }
        });
    </script>

</body>

</html>